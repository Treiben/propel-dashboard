@Ui_Api_HostAddress_Https = https://localhost:7113
@Ui_Api_HostAddress_Http = http://localhost:5038
@Ui_Api_HostAddress_Docker = http://localhost:5003

### Variables
@baseUrl = {{Ui_Api_HostAddress_Docker}}/api
@testFlagKey = test-flag-4851245
@testUserId = user-{{$randomInt}}

### Authentication Tokens
@api_jwt = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IkFwaVNjb3BlVXNlciIsInN1YiI6IkFwaVNjb3BlVXNlciIsImp0aSI6IjNhZWVjZWRlIiwic2NvcGUiOiJmZWF0dXJldG9nZ2xlc21hbmFnZW1lbnRhcGkiLCJhdWQiOlsiaHR0cDovL2xvY2FsaG9zdDo1MDM4IiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NzExMyJdLCJuYmYiOjE3NTM1MDAyNjEsImV4cCI6MTc2MTQ0OTA2MSwiaWF0IjoxNzUzNTAwMjYyLCJpc3MiOiJkb3RuZXQtdXNlci1qd3RzIn0.r1u7xaYjgAFoVsx6ddDJLtXIuYWlyUHAQC7UZkjojIw
@readonly_jwt =  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IlJlYWRVc2VyIiwic3ViIjoiUmVhZFVzZXIiLCJqdGkiOiI2MTczNDRlIiwic2NvcGUiOlsiZmVhdHVyZXRvZ2dsZXNtYW5hZ2VtZW50YXBpIiwicmVhZCJdLCJhdWQiOlsiaHR0cDovL2xvY2FsaG9zdDo1MDM4IiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NzExMyJdLCJuYmYiOjE3NTM1MDAzNDgsImV4cCI6MTc2MTQ0OTE0OCwiaWF0IjoxNzUzNTAwMzQ5LCJpc3MiOiJkb3RuZXQtdXNlci1qd3RzIn0.YiW9_-swA8YXVaukSsKiZg-us_3YW0QCGwMtWb-HB4M
@full_access_jwt = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IldyaXRlVXNlciIsInN1YiI6IldyaXRlVXNlciIsImp0aSI6IjkyZjZhNzNmIiwic2NvcGUiOlsiZmVhdHVyZXRvZ2dsZXNtYW5hZ2VtZW50YXBpIiwicmVhZCIsIndyaXRlIl0sImF1ZCI6WyJodHRwOi8vbG9jYWxob3N0OjUwMzgiLCJodHRwczovL2xvY2FsaG9zdDo3MTEzIl0sIm5iZiI6MTc1MzUwMDM3NCwiZXhwIjoxNzYxNDQ5MTc0LCJpYXQiOjE3NTM1MDAzNzQsImlzcyI6ImRvdG5ldC11c2VyLWp3dHMifQ.7_mWTTJ_Jbq1I6Kg65ulyEjTP5mb6VEfhJH1w3iOF0o

@active_token = {{full_access_jwt}}


###
### ================== SETUP TEST DATA FOR PAGING/FILTERING ==================

### Setup 1. Create Test Flags for Paging Tests
# Test: Create multiple flags for pagination testing
# Expected: 201 Created - Environment Production Flag
POST {{baseUrl}}/feature-flags
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "key": "env-prod-flag-{{$randomInt}}",
  "name": "Production Environment Flag",
  "description": "Flag for production environment",
  "status": "Enabled",
  "tags": {
    "environment": "production",
    "team": "backend",
    "priority": "high"
  },
  "isPermanent": false
}

###
### Setup 2. Create Second Test Flag
# Test: Create second flag with different tags and status
# Expected: 201 Created - Environment Staging Flag
POST {{baseUrl}}/feature-flags
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "key": "env-staging-flag-{{$randomInt}}",
  "name": "Staging Environment Flag",
  "description": "Flag for staging environment",
  "status": "Disabled",
  "tags": {
    "environment": "staging",
    "team": "frontend",
    "priority": "medium"
  },
  "isPermanent": false
}

###
### Setup 3. Create Third Test Flag
# Test: Create third flag for comprehensive testing
# Expected: 201 Created - Development Flag
POST {{baseUrl}}/feature-flags
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "key": "env-dev-flag-{{$randomInt}}",
  "name": "Development Environment Flag",
  "description": "Flag for development environment",
  "status": "Percentage",
  "percentageEnabled": 50,
  "tags": {
    "environment": "development",
    "team": "backend",
    "priority": "low"
  },
  "isPermanent": false
}

###
### Setup 4. Create Fourth Test Flag
# Test: Create flag without environment tag
# Expected: 201 Created - Feature Flag without environment
POST {{baseUrl}}/feature-flags
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "key": "feature-experimental-{{$randomInt}}",
  "name": "Experimental Feature Flag",
  "description": "Experimental feature flag",
  "status": "Scheduled",
  "tags": {
    "type": "experimental",
    "team": "research",
    "priority": "high"
  },
  "isPermanent": false
}

###
### ================== TAG FILTERING TESTS ==================

### Tag Filter 1. Filter by Single Tag (Key:Value Format)
# Test: Filter flags by environment:production tag
# Expected: 200 OK with flags that have environment=production tag
GET {{baseUrl}}/feature-flags?tags=environment:production
Authorization: Bearer {{active_token}}

###
### Tag Filter 2. Filter by Multiple Tags (Key:Value Format)
# Test: Filter flags by multiple tags using key:value format
# Expected: 200 OK with flags matching both environment=production AND team=backend
GET {{baseUrl}}/feature-flags?tags=environment:production&tags=team:backend
Authorization: Bearer {{active_token}}

###
### Tag Filter 3. Filter by Tag Key Only
# Test: Filter flags by tag key only (any value)
# Expected: 200 OK with flags that have 'environment' tag (any value)
GET {{baseUrl}}/feature-flags?tags=environment
Authorization: Bearer {{active_token}}

###
### Tag Filter 4. Filter by Tag Keys/Values Arrays
# Test: Filter using parallel tagKeys and tagValues arrays
# Expected: 200 OK with flags matching environment=staging
GET {{baseUrl}}/feature-flags?tagKeys=environment&tagValues=staging
Authorization: Bearer {{active_token}}

###
### Tag Filter 5. Filter by Multiple Tag Keys/Values Arrays
# Test: Filter using multiple tagKeys and tagValues
# Expected: 200 OK with flags matching environment=development AND team=backend
GET {{baseUrl}}/feature-flags?tagKeys=environment&tagKeys=team&tagValues=development&tagValues=backend
Authorization: Bearer {{active_token}}

###
### Tag Filter 6. Filter by Tag Key Only (Keys/Values Arrays)
# Test: Filter by tag key without corresponding value
# Expected: 200 OK with flags that have 'priority' tag (any value)
GET {{baseUrl}}/feature-flags?tagKeys=priority
Authorization: Bearer {{active_token}}

###
### Tag Filter 7. Mismatched TagKeys and TagValues Arrays
# Test: Verify validation when tagKeys and tagValues have different lengths
# Expected: 400 Bad Request with validation error about array length mismatch
GET {{baseUrl}}/feature-flags?tagKeys=environment&tagKeys=team&tagValues=production
Authorization: Bearer {{active_token}}

###
### Tag Filter 8. Invalid Tag Format
# Test: Verify validation for malformed tag format
# Expected: 400 Bad Request with validation error about tag format
GET {{baseUrl}}/feature-flags?tags=:invalid-format
Authorization: Bearer {{active_token}}

###
### Tag Filter 9. Empty Tag Value
# Test: Test empty tag values (should work as key-only search)
# Expected: 200 OK with flags that have the specified tag key
GET {{baseUrl}}/feature-flags?tags=team:
Authorization: Bearer {{active_token}}