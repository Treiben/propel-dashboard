@Ui_Api_HostAddress_Https = https://localhost:7113
@Ui_Api_HostAddress_Http = http://localhost:5038
@Ui_Api_HostAddress_Docker = http://localhost:5003

### Variables
@baseUrl = {{Ui_Api_HostAddress_Docker}}/api
@testFlagKey = test-flag-4851245
@testUserId = user-{{$randomInt}}

### Authentication Tokens
@api_jwt = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IkFwaVNjb3BlVXNlciIsInN1YiI6IkFwaVNjb3BlVXNlciIsImp0aSI6IjNhZWVjZWRlIiwic2NvcGUiOiJmZWF0dXJldG9nZ2xlc21hbmFnZW1lbnRhcGkiLCJhdWQiOlsiaHR0cDovL2xvY2FsaG9zdDo1MDM4IiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NzExMyJdLCJuYmYiOjE3NTM1MDAyNjEsImV4cCI6MTc2MTQ0OTA2MSwiaWF0IjoxNzUzNTAwMjYyLCJpc3MiOiJkb3RuZXQtdXNlci1qd3RzIn0.r1u7xaYjgAFoVsx6ddDJLtXIuYWlyUHAQC7UZkjojIw
@readonly_jwt =  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IlJlYWRVc2VyIiwic3ViIjoiUmVhZFVzZXIiLCJqdGkiOiI2MTczNDRlIiwic2NvcGUiOlsiZmVhdHVyZXRvZ2dsZXNtYW5hZ2VtZW50YXBpIiwicmVhZCJdLCJhdWQiOlsiaHR0cDovL2xvY2FsaG9zdDo1MDM4IiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NzExMyJdLCJuYmYiOjE3NTM1MDAzNDgsImV4cCI6MTc2MTQ0OTE0OCwiaWF0IjoxNzUzNTAwMzQ5LCJpc3MiOiJkb3RuZXQtdXNlci1qd3RzIn0.YiW9_-swA8YXVaukSsKiZg-us_3YW0QCGwMtWb-HB4M
@full_access_jwt = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6IldyaXRlVXNlciIsInN1YiI6IldyaXRlVXNlciIsImp0aSI6IjkyZjZhNzNmIiwic2NvcGUiOlsiZmVhdHVyZXRvZ2dsZXNtYW5hZ2VtZW50YXBpIiwicmVhZCIsIndyaXRlIl0sImF1ZCI6WyJodHRwOi8vbG9jYWxob3N0OjUwMzgiLCJodHRwczovL2xvY2FsaG9zdDo3MTEzIl0sIm5iZiI6MTc1MzUwMDM3NCwiZXhwIjoxNzYxNDQ5MTc0LCJpYXQiOjE3NTM1MDAzNzQsImlzcyI6ImRvdG5ldC11c2VyLWp3dHMifQ.7_mWTTJ_Jbq1I6Kg65ulyEjTP5mb6VEfhJH1w3iOF0o

@active_token = {{full_access_jwt}}

###
### 1. Set Time Window - Valid Configuration
# Test: Set a valid time window with specific days
# Expected: 200 OK with updated FeatureFlagDto (status: "TimeWindow")
POST {{baseUrl}}/feature-flags/{{testFlagKey}}/time-window
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "windowStartTime": "09:00:00",
  "windowEndTime": "17:00:00",
  "timeZone": "UTC",
  "windowDays": [1, 2, 3, 4, 5]
}

###
### 2. Set Time Window - All Days (Empty Array)
# Test: Set time window with empty days array (should default to all days)
# Expected: 200 OK with all days of week included
POST {{baseUrl}}/feature-flags/{{testFlagKey}}/time-window
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "windowStartTime": "10:00:00",
  "windowEndTime": "18:00:00",
  "timeZone": "America/New_York",
  "windowDays": []
}

###
### 3. Set Time Window - Invalid Time Range
# Test: Verify validation fails when end time is before start time
# Expected: 400 Bad Request with validation problem details
POST {{baseUrl}}/feature-flags/{{testFlagKey}}/time-window
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "windowStartTime": "17:00:00",
  "windowEndTime": "09:00:00",
  "timeZone": "UTC",
  "windowDays": [1, 2, 3, 4, 5]
}

###
### 4. Set Time Window - Invalid Time Zone
# Test: Verify validation fails for invalid time zone
# Expected: 400 Bad Request with validation problem details
POST {{baseUrl}}/feature-flags/{{testFlagKey}}/time-window
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "windowStartTime": "09:00:00",
  "windowEndTime": "17:00:00",
  "timeZone": "Invalid/TimeZone",
  "windowDays": [1, 2, 3, 4, 5]
}

###
### 5. Remove Time Window - Basic Removal
# Test: Remove time window from a previously configured flag
# Expected: 200 OK with time window fields cleared
POST {{baseUrl}}/feature-flags/{{testFlagKey}}/time-window
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "windowStartTime": "00:00:01",
  "windowEndTime": "00:00:02",
  "timeZone": "UTC",
  "windowDays": [],
  "removeTimeWindow": true
}

###
### 6. Remove Time Window - Validation Bypass
# Test: Verify that validation is bypassed when removeTimeWindow is true
# Expected: 200 OK (invalid times should be ignored when removing)
POST {{baseUrl}}/feature-flags/{{testFlagKey}}/time-window
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "windowStartTime": "00:00:00",
  "windowEndTime": "00:00:00",
  "timeZone": "Invalid/TimeZone",
  "windowDays": [],
  "removeTimeWindow": true
}

###
### 7. Time Window - Nonexistent Flag
# Test: Attempt to set time window on a flag that doesn't exist
# Expected: 404 Not Found
POST {{baseUrl}}/feature-flags/nonexistent-flag-key/time-window
Content-Type: application/json
Authorization: Bearer {{active_token}}

{
  "windowStartTime": "09:00:00",
  "windowEndTime": "17:00:00",
  "timeZone": "UTC",
  "windowDays": [1, 2, 3, 4, 5]
}
